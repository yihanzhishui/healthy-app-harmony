# 「健康方舟」接口文档

## 说明

这是毕设项目「健康方舟」的后台接口文档、「健康方舟」是一款基于 HarmonyOS、使用 ArkTS 语言开发的原生鸿蒙应用。

**登录过后：所有的请求都请在请求头带上 `token`**

## 请求基地址

TODO 记得设置

XXXXXX

## 全局响应状态码

| 分类 | 分类描述                                       |
| :--- | :--------------------------------------------- |
| 1XXX | 信息，服务器收到请求，需要请求者继续执行操作   |
| 2XXX | 成功，操作被成功接收并处理                     |
| 3XXX | 重定向，需要进一步的操作以完成请求             |
| 4XXX | 客户端错误，请求包含语法错误或无法完成请求     |
| 5XXX | 服务器错误，服务器在处理请求的过程中发生了错误 |

| 状态码 | 状态码英文名称        | 中文描述                                       |
| :----- | :-------------------- | :--------------------------------------------- |
| 1000   | Continue              | 本次请求成功，但需要进行操作                   |
| 1001   | Other Error           | 请求成功，但出现其他错误                       |
| 2000   | OK                    | 请求成功                                       |
| 2001   | Created               | 已创建。成功请求并创建了新的数据条目           |
| 4000   | Bad Request           | 客户端请求的语法错误，服务器无法理解           |
| 4001   | Unauthorized          | 请求要求用户的身份认证                         |
| 4002   | Unknown Error         | 未知错误                                       |
| 4003   | Forbidden             | 服务器理解请求客户端的请求，但是拒绝执行此请求 |
| 4004   | Not Found             | 服务器无法根据客户端的请求找到资源（网页）     |
| 4005   | Method Not Allowed    | 客户端请求中的方法被禁止                       |
| 5000   | Internal Server Error | 服务器内部错误，无法完成请求                   |
| 5001   | Database Error        | 数据库出错                                     |

## 验证码相关

### 获取短信验证码

#### 简要概述

- 获取短信验证码

#### 请求URL

- `get_sms_verification_code`

#### 请求方式

- get

#### 参数

| 参数名 | 必选 | 类型   | 说明     |
| :----- | :--- | :----- | -------- |
| phone  | 是   | string | 电话号码 |

#### 返回示例

- 成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "验证码发送成功，请注意短信"
}
```

- 失败

```json
{
   "status": "error",
	"code": 5000,
	"message": "验证码发送失败，请稍后重试"
}
```

### 获取邮箱验证码

#### 简要概述

- 获取短信验证码

#### 请求URL

- `get_email_verification_code`

#### 请求方式

- get

#### 参数

| 参数名 | 必选 | 类型   | 说明     |
| :----- | :--- | :----- | -------- |
| email  | 是   | string | 邮箱号码 |

#### 返回示例

- 成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "验证码发送成功，请注意邮箱"
}
```

- 失败

```json
{
   "status": "error",
	"code": 5000,
	"message": "验证码发送失败，请稍后重试"
}
```

## 用户相关

### 短信验证码登录

#### 简要概述

- 用户使用短信验证码登录
- 应该注意：如果用户选择使用短信验证码登录时、应该检查该用户是否已经注册

  - 若已注册，直接登录
  - 若未注册，则应引导其设置密码

#### 请求URL

- `login_by_sms_verification_code`

#### 请求方式

- post

#### 参数

| 参数名   | 必选 | 类型   | 说明       |
| :------- | :--- | :----- | ---------- |
| phone    | 是   | string | 电话号码   |
| sms_code | 是   | string | 短信验证码 |

#### 返回示例

- 登录成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "登陆成功",
    "data": {
        "user_id": 10001,
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... "
    }
}
```

- 登录失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "登录失败，请稍后重试"
}
```

- 第一次登录、需要设置密码

```json
{
    "status": "continue",
	"code": 1000,
	"message": "请设置密码"
}
```

### 邮箱验证码登录

#### 简要概述

- 用户使用邮箱验证码登录
- 应该注意：如果用户选择使用邮箱验证码登录时、应该检查该用户是否已经注册

  - 若已注册，直接登录
  - 若未注册，则应引导其绑定手机号、设置密码

#### 请求URL

- `login_by_email_verification_code`

#### 请求方式

- post

#### 参数

| 参数名     | 必选 | 类型   | 说明       |
| :--------- | :--- | :----- | ---------- |
| email      | 是   | string | 邮箱号     |
| email_code | 是   | string | 邮箱验证码 |

#### 返回示例

- 登录成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "登陆成功",
    "data": {
        "user_id": 10001,
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... "
    }
}
```

- 登录失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "登录失败，请稍后重试"
}
```

- 第一次登录、需要设置密码

```json
{
    "status": "continue",
	"code": 1000,
	"message": "请绑定手机号、设置密码"
}
```

### 使用华为账号登录

#### 简要概述

- 用户使用华为账号认证登录

  - 后端应该调用华为的认证服务，将登陆成功的 `token`信息保存在本地
- 应该注意：检查该用户是否已经注册

  - 若已注册，直接登录
  - 若未注册，则应引导其绑定手机号、设置密码

#### 请求URL

- `login_by_huawei_account`

#### 请求方式

- get

#### 返回示例

- 登录成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "登陆成功",
    "data": {
        "user_id": 10001,
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... "
    }
}
```

- 登录失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "登录失败，请稍后重试"
}
```

- 第一次登录、需要绑定手机号、设置密码

```json
{
    "status": "continue",
	"code": 1000,
	"message": "请绑定手机号、设置密码"
}
```

### 绑定手机号

#### 简要概述

- 当用户使用邮箱验证码或华为账号登录时、若未注册、调用此接口绑定手机号并设置密码

#### 请求URL

- `binding_phone`

#### 请求方式

- post

#### 参数

| 参数名            | 必选 | 类型   | 说明           |
| :---------------- | :--- | :----- | -------------- |
| user_id           | 是   | number | 用户id         |
| phone             | 是   | string | 电话号码       |
| sms_code          | 是   | string | 短信验证码     |
| password          | 是   | string | 密码           |
| email             | 否   | string | 邮箱           |
| huawei_auth_token | 否   | string | 华为认证 token |

- 说明：**email 和 huawei_auth_token 不可同时为空**

#### 返回示例

- 绑定成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "绑定成功",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... "
    }
}
```

- 绑定失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "绑定失败，请稍后重试"
}
```

- 绑定失败

```json
{
    "status": "error",
	"code": 1001,
	"message": "该手机号已注册"
}
```

### 绑定邮箱号

#### 简要概述

- 用户使用其他方式登录过后，绑定邮箱

#### 请求URL

- `binding_email`

#### 请求方式

- put

#### 参数

| 参数名     | 必选 | 类型   | 说明       |
| :--------- | :--- | :----- | ---------- |
| user_id    | 是   | number | 用户id     |
| phone      | 否   | string | 电话号码   |
| email      | 是   | string | 邮箱       |
| email_code | 是   | string | 邮箱验证码 |

#### 返回示例

- 绑定成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "绑定成功"
}
```

- 绑定失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "绑定失败，请稍后重试"
}
```

- 绑定失败

```json
{
    "status": "error",
	"code": 1001,
	"message": "该邮箱已绑定其他账号"
}
```

### 更改昵称

#### 简要概述

- 更改昵称

#### 请求URL

- `update_username`

#### 请求方式

- put

#### 参数

| 参数名   | 必选 | 类型   | 说明     |
| :------- | :--- | :----- | -------- |
| user_id  | 是   | number | 用户id   |
| phone    | 否   | string | 电话号码 |
| username | 是   | string | 昵称     |

#### 返回示例

- 成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "修改成功"
}
```

- 失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "修改失败，请稍后重试"
}
```

### 更改头像

#### 简要概述

- 更改头像

#### 请求URL

- `update_avatar`

#### 请求方式

- put

#### 参数

| 参数名  | 必选 | 类型     | 说明     |
| :------ | :--- | :------- | -------- |
| user_id | 是   | number   | 用户id   |
| phone   | 否   | string   | 电话号码 |
| avatar  | 是   | formData | 头像     |

#### 返回示例

- 成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "修改成功"
}
```

- 失败

```json
{
    "status": "error",
	"code": 4002,
	"message": "修改失败，请稍后重试"
}
```

### 注销账户

#### 简要概述

- 注销账户

#### 请求URL

- `delete_user`

#### 请求方式

- delete

#### 参数

| 参数名   | 必选 | 类型   | 说明       |
| :------- | :--- | :----- | ---------- |
| user_id  | 是   | number | 用户id     |
| sms_code | 是   | string | 短信验证码 |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "成功",
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "失败"
}
```

## 睡眠相关

### 记录睡眠

#### 简要概述

- 记录睡眠状况、新增睡眠数据

#### 请求URL

- `add_sleep_record`

#### 请求方式

- put

#### 参数

| 参数名            | 必选 | 类型   | 说明   |
| :---------------- | :--- | :----- | ------ |
| user_id           | 是   | number | 用户id |
| bed_time          | 是   | string |        |
| sleep_interval    | 是   | number |        |
| wake_time         | 是   | string |        |
| wake_up_interval  | 是   | number |        |
| bed_time_duration | 是   | number |        |
| record_time       | 是   | string |        |

#### 返回示例

- 成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "记录成功"
}
```

- 失败

```json
{
	"status": "error",
	"code": 4002,
	"message": "记录失败，请稍后重试"
}
```

### 获取最新一条睡眠数据

#### 简要概述

- 获取最新一条睡眠情况的数据

#### 请求URL

- `get_lastest_day_sleep_record`

#### 请求方式

- get

#### 参数

| 参数名  | 必选 | 类型   | 说明   |
| :------ | :--- | :----- | ------ |
| user_id | 是   | number | 用户id |

#### 返回示例

- 成功

```json
{
	"status": "success",
	"code": 2000,
	"message": "获取成功",
    "data": {
        "sleep_record_id": 12,
        "sleep_quality": "优质睡眠",
        "sleep_duration": 480,
        "asleep_time": "2024-03-20 23:00:00",
        "wake_up_time": "2024-03-21 07:00:00",
    }
}
```

- 失败

```json
{
	"status": "error",
	"code": 4002,
	"message": "记录失败，请稍后重试"
}
```

### 获取本周睡眠数据

#### 简要概述

- 获取最近一周睡眠情况的数据

#### 请求URL

- `get_this_week_sleep_record`

#### 请求方式

- get

#### 参数

| 参数名  | 必选 | 类型   | 说明   |
| :------ | :--- | :----- | ------ |
| user_id | 是   | number | 用户id |

#### 返回示例

- 成功（数据可能有错误，但格式如此）

```json
{
    "status": "success",
    "code": 2000,
    "message": "获取成功",
    "data": {
        "average_sleep_duration": 309,
        "average_asleep_time": "01:20:00",
        "average_wake_time": "07:20:00",
        "earliest_wake_up_time": "07:12:00",
        "lastest_asleep_time": "02:00:00",
        "data_list": [
        	{
                "sleep_record_id": 1,
                "record_time": "2024-03-05 08:00:00",
                "sleep_duration": 420,
                "wake_time": "07:12:00",
                "asleep_time": "01:20:00"
            },
            {
                "sleep_record_id": 2,
                "record_time": "2024-03-05 08:00:00",
                "sleep_duration": 400,
                "wake_time": "07:12:00",
                "asleep_time": "01:20:00"
            },
            {
                "sleep_record_id": 3,
                "record_time": "2024-03-05 08:00:00",
                "sleep_duration": 412,
                "wake_time": "07:12:00",
                "asleep_time": "01:20:00"
            },
        ]
    }
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "获取记录失败"
}
```

## 音乐相关

### 获取音乐所有分类列表

#### 简要概述

- 获取音乐所有分类列表

#### 请求URL

- `get_music_category_list`

#### 请求方式

- get

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "获取成功",
    "data": {
        "category_list": ['深睡提升','快速入睡','浅睡改善','减压放松','舒缓疗愈','唤醒晨间','日间小憩']
    }
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "获取失败，请稍后重试"
}
```

### 根据分类获取音乐基本信息

#### 简要概述

- 根据分类获取音乐基本信息列表

#### 请求URL

- `get_music_info_by_category`

#### 请求方式

- get

#### 参数

| 参数名   | 必选 | 类型   | 说明     |
| :------- | :--- | :----- | -------- |
| user_id  | 是   | number | 用户id   |
| category | 是   | string | 音乐分类 |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "获取成功",
    "data": {
       "music_list": [
           {
               "music_id": 2,
               "music_name": "沙沙雨声",
               "listen_count": 120,
               "music_album_cover": "../assets/image/music_album_cover/music_1_pic.png",
               "is_favorite": true
           }，
           {
               "music_id": 3,
               "music_name": "白噪音让你快速入眠",
               "listen_count": 230,
               "music_album_cover": "../assets/image/music_album_cover/music_2_pic.png",
               "is_favorite": false
           }
       ]
    }
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "获取失败，请稍后重试"
}
```

### 获取具体音乐信息

#### 简要概述

- 获取某一首具体音乐信息

#### 请求URL

- `get_music`

#### 请求方式

- get

#### 参数

| 参数名  | 必选 | 类型   | 说明   |
| :------ | :--- | :----- | ------ |
| user_id | 是   | number | 用户id |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "获取成功",
    "data": {
        "music_id": 2,
        "music_name": "沙沙雨声",
        "tags": ["减压放松","洗涤烦躁","情绪疗愈"],
        "listen_count": 123,
        "is_favorite": true,
        "music_album_cover": "../assets/image/music_album_cover/music_1_pic.png",
        "music_file_path": "../assets/music/music_1.mp3"
    }
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "获取失败，请稍后重试"
}
```

### 收藏音乐

#### 简要概述

- 收藏音乐

#### 请求URL

- `add_favorite_music`

#### 请求方式

- post

#### 参数

| 参数名        | 必选 | 类型   | 说明     |
| :------------ | :--- | :----- | -------- |
| user_id       | 是   | number | 用户id   |
| music_id      | 是   | number | 音乐id   |
| favorite_time | 是   | string | 收藏时间 |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "收藏成功",
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "收藏失败，请稍后重试"
}
```

### 获取收藏音乐列表

#### 简要概述

- 获取某个用户收藏音乐列表

#### 请求URL

- `get_favorite_music_list_by_user_id`

#### 请求方式

- get

#### 参数

| 参数名  | 必选 | 类型   | 说明   |
| :------ | :--- | :----- | ------ |
| user_id | 是   | number | 用户id |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "获取成功",
    "data": {
       "music_list": [
           {
               "music_id": 2,
               "music_name": "沙沙雨声",
               "listen_count": 120,
               "music_album_cover": "../assets/image/music_album_cover/music_1_pic.png",
               "is_favorite": true,
               "favorite_time": "2024-04-02 12:23:00"
           }，
           {
               "music_id": 3,
               "music_name": "白噪音让你快速入眠",
               "listen_count": 230,
               "music_album_cover": "../assets/image/music_album_cover/music_2_pic.png",
               "is_favorite": true,
               "favorite_time": "2024-04-02 12:23:00"
           }
       ]
    }
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "获取失败"
}
```

### 修改音乐信息

#### 简要概述

- 修改音乐信息

#### 请求URL

- `update_music_info`

#### 请求方式

- put

#### 参数

| 参数名            | 必选 | 类型   | 说明   |
| :---------------- | :--- | :----- | ------ |
| music_id          | 是   | number | 音乐id |
| TODO 记得有空补完 |      |        |        |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "修改成功",
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "修改失败，请稍后重试"
}
```

### 新增音乐

#### 简要概述

- 新增一条音乐数据

#### 请求URL

- `add_music`

#### 请求方式

- post

#### 参数

| 参数名            | 必选 | 类型   | 说明     |
| :---------------- | :--- | :----- | -------- |
| music_name        | 是   | string | 音乐名称 |
| TODO 记得有空补完 |      |        |          |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "成功",
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "失败"
}
```

### 删除音乐

#### 简要概述

- 删除一条音乐数据

#### 请求URL

- `delete_music`

#### 请求方式

- delete

#### 参数

| 参数名   | 必选 | 类型   | 说明   |
| :------- | :--- | :----- | ------ |
| music_id | 是   | number | 音乐id |

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "成功"
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "失败"
}
```

## 饮食相关

### 获取食物列表

#### 简要概述

- 获取食物列表

#### 请求URL

- `get_food_list`

#### 请求方式

- get

#### 返回示例

- 成功

```json
{
    "status": "success",
    "code": 2000,
    "message": "获取成功",
    "data": {
        "sleep_record_id": 12,
        "sleep_quality": "优质睡眠",
        "sleep_duration": 480,
        "bed_time": "2024-3-20 23:00:00",
        "wake_time": "2024-3-21 07:00:00",
    }
}
```

- 失败

```json
{
    "status": "error",
    "code": 4002,
    "message": "记录失败，请稍后重试"
}
```
